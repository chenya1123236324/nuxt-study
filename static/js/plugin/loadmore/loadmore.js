(function(){var e=Widget.extend({attrs:{dir:"vertical",speed:.5,threshold:50,showNextHint:!0,showPreHint:!1,mode:"append",page:1,isLastPage:!1,hintContent:{firstPageText:"\u5f53\u524d\u9875\u4e3a\u7b2c\u4e00\u9875",lastPageText:"\u5f53\u524d\u9875\u4e3a\u6700\u540e\u4e00\u9875",hintLoading:"\u52a0\u8f7d\u4e2d...",nextPageHintDefault:"\u4e0a\u62c9\u52a0\u8f7d\u7b2c{$pn}\u9875",nextPageHintPrepare:"\u91ca\u653e\u52a0\u8f7d\u7b2c{$pn}\u9875",prePageHintDefault:"\u4e0b\u62c9\u52a0\u8f7d\u7b2c{$pn}\u9875",prePageHintPrepare:"\u91ca\u653e\u52a0\u8f7d\u7b2c{$pn}\u9875"}},setup:function(){this.isLoading=!1,this.hintContent=this.get("hintContent"),this.initialized=!1,this.prePageHint=$('<div class="hint pre">'+this.hintContent.firstPageText+"</div>"),this.prePageHint.insertBefore(this.$element.children().first());var e=this.isLastPage?this.hintContent.lastPageText:this.hintContent.nextPageHintDefault.replace("{$pn}",2);this.nextPageHint=$('<div class="hint next">'+e+"</div>"),this.$element.append(this.nextPageHint),this.s=new Swipable({element:this.$element,dir:this.get("dir")}),this.s.$view=this.$element.children(),this.s.min=this._getMin(),this.s.max=this.get("showPreHint")?0:-this.$element.find(".hint.pre").height();if(this.s.min>=0){this.$element.find(".hint").hide(),this.s.min=this._getMin(),this.initialized=!1;return}this._init()},_getMin:function(){var e=this.s.isVertical?this.$element.height()-this._getContentSize("height"):this.$element.width()-this._getContentSize("width");return this.get("showNextHint")||(e+=this.$element.find(".hint.next").height()),e},_getContentSize:function(e){var t=0;for(var n=0;n<this.s.$view.length;n++)t+=this.s.$view.eq(n)[e]();return t},_init:function(){this.s._initEvents(),this._initHandlers(),this.get("showPreHint")||this.s._scroll(this.s.max),$(window).on("resize",this.refresh)},refresh:function(){this.initialized||(this._init(),this.initialized=!0),this._changeHintCont("Default"),this.isLoading=!1,this.get("mode")=="replace"?this.s._scroll(this.s.max):this.get("mode")=="append"&&this.get("page")!==1&&this.s._scroll(this.s.min-this.get("threshold")),this.s.min=this._getMin()},prePage:function(){this.set("page",this.get("page")-1),this.set("isLastPage",!1),this._changeHintCont("Loading","pre")},nextPage:function(){this.set("page",this.get("page")+1),this._changeHintCont("Loading","next")},_changeHintCont:function(e,t){if(e=="Loading"){t==="pre"&&this.get("mode")=="replace"?this.prePageHint.html(this.hintContent.hintLoading):t==="next"&&this.nextPageHint.html(this.hintContent.hintLoading),this.isLoading=!0;return}this.get("mode")=="replace"&&this.prePageHint.html(this.hintContent["prePageHint"+e]),this.nextPageHint.html(this.hintContent["nextPageHint"+e]),e!=="Loading"&&(this.get("mode")=="replace"&&this.prePageHint.html(this.hintContent["prePageHint"+e].replace("{$pn}",this.get("page")-1)),this.nextPageHint.html(this.hintContent["nextPageHint"+e].replace("{$pn}",this.get("page")+1))),this.get("isLastPage")&&this.nextPageHint.html(this.hintContent.lastPageText),this.get("page")<=1&&this.get("mode")=="replace"&&this.prePageHint.html(this.hintContent.firstPageText)},_initHandlers:function(){var e=this;e.on("change:isLastPage",function(){e._changeHintCont("Default")}),e.s.on("drag",function(t){e.isLoading||(e.s.offset+e.get("threshold")<e.s.min?e._changeHintCont("Prepare"):e.s.offset<e.s.min&&e._changeHintCont("Default"),e.s.offset-e.get("threshold")>e.s.max?e._changeHintCont("Prepare"):e.s.offset>e.s.max&&e._changeHintCont("Default"))}),e.s.on("release",function(t){e.s.offset+e.get("threshold")<e.s.min&&!e.isLoading&&!e.get("isLastPage")&&e.nextPage(),e.get("page")>1&&e.get("mode")=="replace"&&e.s.offset-e.get("threshold")>e.s.max&&!e.isLoading&&e.prePage()})}});this.Loadmore=e})();